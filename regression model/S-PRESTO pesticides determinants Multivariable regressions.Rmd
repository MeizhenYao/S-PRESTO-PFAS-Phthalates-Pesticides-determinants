---
title: "S-PRESTO pesticides determinants Multivariable regressions"
author: "Meizhen Yao"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: united
    highlight: tango
    df_print: paged
    fig_caption: yes
    fig_height: 7
    fig_width: 10
    number_sections: yes
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    self_contained: yes
    code_folding: hide
    toc_depth: 6
header-includes: \usepackage{multirow}
---

<style type="text/css">
body{
  /*font-family: Helvetica;*/
  font-size: 12pt;
}
</style>


```{r setup, include=FALSE}
options(digits = 4)
knitr::opts_chunk$set(echo = TRUE,tidy=TRUE,cache=F,warning = FALSE)
# suppress warning messages for final rendering
old.warn <- getOption("warn")
options(qwraps2_markup = "markdown")

```


```{r, message=FALSE,warning=FALSE}
# load packages
library(broom)
library(gtsummary)
library(gt)
library(tidyverse)
library(ggpubr)
library(cowplot)
library(gridExtra)
library(readxl)
library(boot)
library(table1)
library(flextable)
library(plyr)
library(Rcpp)
library(modelr)
library(readr)
library(gWQS)
library(broom.mixed)
library(yaml)
library(rmarkdown)
library(officer)
library(scales)
library(lme4)

# import data (change the path to the location where you save the dataset)
pesticides<- read_excel("C:/Users/yaom03/OneDrive - The Mount Sinai Hospital/Projects/S-PRESTO/input/for paper/chemical_paper/prepared_pesticides_long_20230317.xlsx")


## log transformation
pest_log <- pesticides %>% 
            mutate(adjusted_PBA_log=log2(adjusted_PBA), 
                              adjusted_CIS_DCCA_log=log2(adjusted_CIS_DCCA), 
                              adjusted_TRANS_DCCA_log=log2(adjusted_TRANS_DCCA), 
                              adjusted_PNP_log=log2(adjusted_PNP), 
                              adjusted_TCP_log=log2(adjusted_TCP), 
                              adjusted_DMP_log=log2(adjusted_DMP), 
                              adjusted_DMTP_log=log2(adjusted_DMTP), 
                              adjusted_DMDP_log=log2(adjusted_DMDP), 
                              adjusted_DEP_log=log2(adjusted_DEP), 
                              adjusted_DETP_log=log2(adjusted_DETP), 
                              adjusted_DEDP_log=log2(adjusted_DEDP),
            TotalFish_sc = (TotalFish - mean(TotalFish))/sd(TotalFish),
            Fast_food_sc = (Fast_food - mean(Fast_food))/sd(Fast_food),
            fruit_sc = (fruit - mean(fruit))/sd(fruit),
            vegetable_sc = (vegetable - mean(vegetable))/sd(vegetable),
            vegetable_boil_sc = (vegetable_boil - mean(vegetable_boil))/sd(vegetable_boil),
            vegetable_SF_sc = (vegetable_SF - mean(vegetable_SF))/sd(vegetable_SF),
            Styrofoam_boxes_freq_mean_sc = (Styrofoam_boxes_freq_mean - mean(Styrofoam_boxes_freq_mean))/sd(Styrofoam_boxes_freq_mean),
            Plastic_boxes_freq_mean_sc = (Plastic_boxes_freq_mean - mean(Plastic_boxes_freq_mean))/sd(Plastic_boxes_freq_mean))


### covariates
pest_log$ethnicity_specified_recat<- factor(pest_log$ethnicity_specified_recat,
                                            levels = c("Chinese", "Indian/Malay"))

pest_log$pcv1_highest_education_completed_recat<- factor(pest_log$pcv1_highest_education_completed_recat,
                                           levels=c("University","Primary/Secondary/Post_secondary"))

pest_log$pcv1_household_income_recat<- factor(pest_log$pcv1_household_income_recat,
                                           levels=c("$6,376 and below","$6,377 - $11,293","$11,294 and above"))


pest_log$pcv1_parity_recat<- factor(pest_log$pcv1_parity_recat,
                                  levels=c("0",">= 1"))



pest_log$age_at_recruitment_cat <- factor(pest_log$age_at_recruitment_cat,
                                           levels=c("Age first tertile","Age second tertile","Age third tertile"))


pest_log$Styrofoam_boxes<- factor(pest_log$Styrofoam_boxes,
                                        levels = c("No", "Yes"))
pest_log$Plastic_boxes<- factor(pest_log$Plastic_boxes,
                                        levels = c("No", "Yes"))



pest_log$occupation<- factor(pest_log$occupation,
                            levels = c("Not working", "Office worker", "Health care worker", "Service worker"))

## pesticides information
pest<- c('adjusted_PBA_log','adjusted_CIS_DCCA_log','adjusted_TRANS_DCCA_log','adjusted_PNP_log','adjusted_TCP_log','adjusted_DMP_log','adjusted_DMTP_log','adjusted_DMDP_log','adjusted_DEP_log','adjusted_DETP_log','adjusted_DEDP_log')

str(pest_log)

tbl_summary(pest_log,
            include = c(ethnicity_specified_recat, age_at_recruitment_cat, pcv1_highest_education_completed_recat, pcv1_household_income_recat, pcv1_parity_recat, 
         Styrofoam_boxes,Plastic_boxes,
         occupation)) %>% 
   bold_labels()

```

# Linear Mixed-effect models
## model1: sociodemographic factors
```{r, message=FALSE,warning=FALSE}


## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )


model1<- pest_mixreg1_coefs_data


## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel



```



## model2: one dietary factor + sociodemographic factors
### Parity
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ pcv1_parity_recat + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )
## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results

parity<- pest_mixreg1_coefs_data %>% 
         filter(term == "pcv1_parity_recat>= 1")

# ####### extract results
pest_model1<- rbind(model1,
                    parity)

write_csv(pest_model1, "C:/Users/yaom03/OneDrive - The Mount Sinai Hospital/Documents/Projects/S-PRESTO/code/R/chemical & covariates/plot_data/pest_model1_raw.csv")
```



### Total fish
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ TotalFish_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )
## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
fish<- pest_mixreg1_coefs_data %>% 
       filter(term == "TotalFish_sc")
```


### Fast food
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ Fast_food_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )
## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
fast_food<- pest_mixreg1_coefs_data %>% 
       filter(term == "Fast_food_sc")
```

### Fruit
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ fruit_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )
## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
fruit<- pest_mixreg1_coefs_data %>% 
        filter(term == "fruit_sc")
```


### Vegetable
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ vegetable_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )
## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
vegetable<- pest_mixreg1_coefs_data %>% 
        filter(term == "vegetable_sc")
```


### Styrofoam boxes
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ Styrofoam_boxes + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )
## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
Styrofoam_boxes<- pest_mixreg1_coefs_data %>% 
            filter(term == "Styrofoam_boxesYes")
```



### Plastic boxes
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_mixreg1 <-
  lapply(pest, function(x){
    
    lmer(formula = substitute(i ~ Plastic_boxes + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation + (1 | Subject_ID), 
                           list(i = as.name(x))),
      data = pest_log)
    
  })

## extract coefficients with confidence interval
pest_mixreg1_coefs <- lapply(pest_mixreg1, tidy, conf.int = T)
names(pest_mixreg1_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_mixreg1_coefs_data1 <- bind_rows(pest_mixreg1_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_mixreg1_coefs_data <- pest_mixreg1_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           dplyr::select(pest, term, Estimate, conf.low, conf.high) 

pest_mixreg1_coefs_data$sig<- ifelse(pest_mixreg1_coefs_data$conf.low >0 & pest_mixreg1_coefs_data$conf.high >0 | pest_mixreg1_coefs_data$conf.low <0 & pest_mixreg1_coefs_data$conf.high <0, "*", NA )
## put result into one table
tabel<- flextable(as_grouped_data(pest_mixreg1_coefs_data, groups = "pest")) %>%          color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
Plastic_boxes<- pest_mixreg1_coefs_data %>% 
            filter(term == "Plastic_boxesYes")
```




```{r}
pest_model2<- rbind(fish,
                    fast_food,
                    fruit,
                    vegetable,
                    Styrofoam_boxes,
                    Plastic_boxes)

######## extract results
write_csv(pest_model2, "C:/Users/yaom03/OneDrive - The Mount Sinai Hospital/Documents/Projects/S-PRESTO/code/R/chemical & covariates/plot_data/pest_model2_raw.csv")



```


# Linear regression models
## pcv2
```{r}
pest_log_pcv2<- pest_log %>% 
                filter(Timepoint=="pcv2")
```

### model1: sociodemographic factors
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(pest_multireg1_pcv2_coefs_data) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel
 
model1<- pest_multireg1_pcv2_coefs_data

```


### model2: one dietary factor + sociodemographic factors
#### Parity
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ pcv1_parity_recat + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high)

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results

######## extract results
parity<- pest_multireg1_pcv2_coefs_data %>% 
         filter(term == "pcv1_parity_recat>= 1")




# ####### extract results
pest_model1<- rbind(model1,
                    parity)


####### extract results
write_csv(pest_model1, "C:/Users/yaom03/OneDrive - The Mount Sinai Hospital/Projects/S-PRESTO/code/R/chemical & covariates/plot_data/pest_model1_pcv2_raw.csv")

```


#### Total fish
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ TotalFish_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation, 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
fish<- pest_multireg1_pcv2_coefs_data %>% 
       filter(term == "TotalFish_sc")

```


#### Fast food
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ Fast_food_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
fast_food<- pest_multireg1_pcv2_coefs_data %>% 
       filter(term == "Fast_food_sc")
```

#### Fruit
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ fruit_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
fruit<- pest_multireg1_pcv2_coefs_data %>% 
        filter(term == "fruit_sc")
```


#### Vegetable
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ vegetable_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
vegetable<- pest_multireg1_pcv2_coefs_data %>% 
        filter(term == "vegetable_sc")

```

#### Styrofoam boxes
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ Styrofoam_boxes + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
Styrofoam_boxes<- pest_multireg1_pcv2_coefs_data %>% 
            filter(term == "Styrofoam_boxesYes")


```


#### Plastic boxes
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ Plastic_boxes + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
Plastic_boxes<- pest_multireg1_pcv2_coefs_data %>% 
            filter(term == "Plastic_boxesYes")



```



```{r}
pest_model2<- rbind(fish,
                    fast_food,
                    fruit,
                    vegetable,
                    Styrofoam_boxes,
                    Plastic_boxes)



######## extract results
write_csv(pest_model2, "C:/Users/yaom03/OneDrive - The Mount Sinai Hospital/Projects/S-PRESTO/code/R/chemical & covariates/plot_data/pest_model2_pcv2_raw.csv")




```



## pgv3
```{r}
pest_log_pcv2<- pest_log %>% 
                filter(Timepoint=="pgv3")
```



### model1: sociodemographic factors
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(pest_multireg1_pcv2_coefs_data) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel
 
model1<- pest_multireg1_pcv2_coefs_data

```


### model2: one dietary factor + sociodemographic factors
#### Parity
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ pcv1_parity_recat + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high)

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results

######## extract results
parity<- pest_multireg1_pcv2_coefs_data %>% 
         filter(term == "pcv1_parity_recat>= 1")




# ####### extract results
pest_model1<- rbind(model1,
                    parity)


####### extract results
write_csv(pest_model1, "C:/Users/yaom03/OneDrive - The Mount Sinai Hospital/Projects/S-PRESTO/code/R/chemical & covariates/plot_data/pest_model1_pgv3_raw.csv")

```


#### Total fish
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ TotalFish_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat + occupation, 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
fish<- pest_multireg1_pcv2_coefs_data %>% 
       filter(term == "TotalFish_sc")

```


#### Fast food
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ Fast_food_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
fast_food<- pest_multireg1_pcv2_coefs_data %>% 
       filter(term == "Fast_food_sc")
```

#### Fruit
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ fruit_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
fruit<- pest_multireg1_pcv2_coefs_data %>% 
        filter(term == "fruit_sc")
```


#### Vegetable
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ vegetable_sc + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
vegetable<- pest_multireg1_pcv2_coefs_data %>% 
        filter(term == "vegetable_sc")

```

#### Styrofoam boxes
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ Styrofoam_boxes + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel


######## extract results
Styrofoam_boxes<- pest_multireg1_pcv2_coefs_data %>% 
            filter(term == "Styrofoam_boxesYes")


```


#### Plastic boxes
```{r, message=FALSE,warning=FALSE}

## Fit the models
pest_multireg1_pcv2 <-
  lapply(pest, function(x){
    
    glm(formula = substitute(i ~ Plastic_boxes + ethnicity_specified_recat + age_at_recruitment_cat + pcv1_highest_education_completed_recat + pcv1_household_income_recat , 
                           list(i = as.name(x))),
      data = pest_log_pcv2,
      family = gaussian())
    
  })

## extract coefficients with confidence interval
pest_multireg1_pcv2_coefs <- lapply(pest_multireg1_pcv2, tidy, conf.int = T)
names(pest_multireg1_pcv2_coefs) <- pest

## combine all lists into one big table
## gives estimates and CI for biomarkers and variables
pest_multireg1_pcv2_coefs_data1 <- bind_rows(pest_multireg1_pcv2_coefs, .id = "pest")


## subset estimates and CI for _only the biomarkers_
pest_multireg1_pcv2_coefs_data <- pest_multireg1_pcv2_coefs_data1 %>% 
                           filter(term != "(Intercept)" & term !=  "sd__(Intercept)" & term !=  "sd__Observation") %>% 
                           mutate(Estimate = round(estimate, 3),
                                  conf.low = round(conf.low, 3),
                                  conf.high = round(conf.high, 3)) %>% 
                           select(pest, term, Estimate, conf.low, conf.high) 

pest_multireg1_pcv2_coefs_data$sig<- ifelse(pest_multireg1_pcv2_coefs_data$conf.low >0 & pest_multireg1_pcv2_coefs_data$conf.high >0 | pest_multireg1_pcv2_coefs_data$conf.low <0 & pest_multireg1_pcv2_coefs_data$conf.high <0, "*", NA )

## put result into one table
tabel<- flextable(as_grouped_data(pest_multireg1_pcv2_coefs_data, groups = c("pest"))) %>%          
        color(~sig == "*", ~conf.low, color = "red")%>% 
        color(~sig == "*", ~conf.high, color = "red")%>%
        theme_box() 
        

tabel

######## extract results
Plastic_boxes<- pest_multireg1_pcv2_coefs_data %>% 
            filter(term == "Plastic_boxesYes")



```



```{r}
pest_model2<- rbind(fish,
                    fast_food,
                    fruit,
                    vegetable,
                    Styrofoam_boxes,
                    Plastic_boxes)



######## extract results
write_csv(pest_model2, "C:/Users/yaom03/OneDrive - The Mount Sinai Hospital/Projects/S-PRESTO/code/R/chemical & covariates/plot_data/pest_model2_pgv3_raw.csv")




```


